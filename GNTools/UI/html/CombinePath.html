<!DOCTYPE html>
<html>
<head>
  <link href="../js/jquery-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/Sketchup.css" type="text/css" charset="utf-8" />
  <style>
  .yellow {
	background: yellow;
    color: black;
	}
  </style>
</head>
<body class="bg-panel-background">
	<div id="tabs">
		<ul>
			<li><a href="#tabs-1" id = "Hole">Trou</a></li>
			<li><a href="#tabs-2" id = "StraitCut">Ligne</a></li>
			<li><a href="#tabs-3" id = "Pocket">Forme</a></li>
		</ul>
		<div id="tabs-1" style="display: none;">
			<div class="container" style="margin: 10px;">
				<label for="methodType_Hole">Select a method</label>
				<select name="methodType_Hole" id="methodType_Hole">
					<option disabled selected>Please pick one</option>
					<option>Inside</option>
					<option>Outside</option>
					<option>Pocket</option>
				</select>
			</div>
			<div class="container" style="margin: 10px;">
				<label>Hole Diameter: <input id="holesize_Hole" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px; display:none;" id = "methoddiv_Hole">
				<label>Cut Width : <input id="cutwidth_Hole" class="def-cnc-input"></label>
			</div>
			
			<div class="container" style="margin: 10px">
				<div id="depthSlider_Hole" style="margin: 10px"></div>
				<label>Depth: <input id="depth_Hole" class="def-cnc-input"> </label>
			</div>
			<div class="container" style="margin: 4px">
				<label>Feed Rate: <input id="feedrate_Hole" class="def-cnc-input"></label>
			</div>
			<div class="container">
				<label>Overlap %: <input id="overlapPercent_Hole" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px;">
				<label>Nombre de Segment <input id="nbdesegment_Hole" class="def-cnc-input"></label>
			</div>

			<div class="container" style="margin: 4px">
				<label for="multipass_Hole">Multiple Pass</label>
				<input type="checkbox" name="multipass_Hole" id="multipass_Hole">
			</div>
			<div class="container" style="margin: 10px; display:none;" id = "multipassdiv_Hole">
				<label>Depth Step: <input id="depthstep_Hole" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px;">
				<label for="drillBitName_Hole">Drill Bit Name:</label>
				<select name="drillBitName_Hole" id="drillBitName_Hole">
					<option disabled selected>Please pick one</option>
				</select>
			</div>
		</div>
		<div id="tabs-2" style="display: none;">
			<div class="container" style="margin: 10px;">
				<label for="methodType_StraitCut">Select a method</label>
				<select name="methodType_StraitCut" id="methodType_StraitCut">
					<option disabled selected>Please pick one</option>
					<option>Ramp</option>
					<option>Spiral</option>
				</select>
			</div>
			<div class="container" style="margin: 10px;">
				<label>Cut Width: <input id="cutwidth_StraitCut" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px">
				<div id="depthSlider_StraitCut" style="margin: 10px"></div>
				<label>Depth: <input id="depth_StraitCut" class="def-cnc-input"> </label>
			</div>
			<div class="container" style="margin: 4px">
				<label>Feed Rate: <input id="feedrate_StraitCut" class="def-cnc-input"></label>
			</div>
			<div class="container">
				<label>Overlap %: <input id="overlapPercent_StraitCut" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 4px">
				<label for="multipass_StraitCut">Multiple Pass</label>
				<input type="checkbox" name="multipass_StraitCut" id="multipass_StraitCut">
			</div>
			<div class="container" style="margin: 10px; display:none;" id = "multipassdiv_StraitCut">
				<label>Depth Step: <input id="depthstep_StraitCut" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px;">
				<label for="drillBitName_StraitCut">Drill Bit Name:</label>
				<select name="drillBitName_StraitCut" id="drillBitName_StraitCut">
				<option disabled selected>Please pick one</option>
				</select>
			</div>
		</div>
		<div id="tabs-3" style="display: none;">
			<div class="container" style="margin: 10px;">
				<label for="methodType_Pocket">Select a method</label>
				<select name="methodType_Pocket" id="methodType_Pocket">
					<option disabled selected>Please pick one</option>
					<option>Inside</option>
					<option>Outside</option>
					<option>Pocket</option>
				</select>
			</div>
			<div class="container" style="margin: 10px; display:none;" id = "methoddiv_Pocket">
				<label>Cut Width : <input id="cutwidth_Pocket" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px">
				<div id="depthSlider_Pocket" style="margin: 10px"></div>
				<label>Depth: <input id="depth_Pocket" class="def-cnc-input"> </label>
			</div>
			<div class="container" style="margin: 4px">
				<label>Feed Rate: <input id="feedrate_Pocket" class="def-cnc-input"></label>
			</div>
			<div class="container">
				<label>Overlap %: <input id="overlapPercent_Pocket" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 4px">
				<label for="multipass_Pocket">Multiple Pass</label>
				<input type="checkbox" name="multipass_Pocket" id="multipass_Pocket">
			</div>
			<div class="container" style="margin: 10px; display:none;" id = "multipassdiv_Pocket">
				<label>Depth Step: <input id="depthstep_Pocket" class="def-cnc-input"></label>
			</div>
			<div class="container" style="margin: 10px;">
				<label for="drillBitName_Pocket">Drill Bit Name:</label>
				<select name="drillBitName_Pocket" id="drillBitName_Pocket" class="ui-state-highlight">
				<option disabled selected>Please pick one</option>
				</select>
			</div>
			<div class="container" style="margin: 10px;">
				<label>Number Of Faces: <input id="numOfEdge" class="def-cnc-input" readonly></label>
			</div>
		</div>
	</div>
    <div class="container" id="ui-footer">
      <div style="width: 100%; background-color: #e3e3e3; border-top: solid #C5C5C5 1px">
        <div style="float: left; margin: 10px">
          <button id="apply" class="ui-button ui-widget ui-corner-all">Set Default</button>
        </div>
        <div style="float: right; margin: 10px">
          <button id="cancel" class="ui-button ui-widget ui-corner-all">Cancel</button>
          <button id="accept" class="ui-button ui-widget ui-corner-all">Ok</button>
        </div>
      </div>
    </div>
 
  <script src="../js/external/jquery/jquery.js"></script>
  <script src="../js/jquery-ui.js"></script>
  <script>
	var spinData = 0;
	var depthData_Hole = [3];
	var depthData_StraitCut = [3];
	var depthData_Pocket = [3];
	var methodData = 0;
	var obj;
	var objs = {};
	var drillBits = [];
	var methodTable3 = [];
	var multipleTable = [];
	
	var tabIndex = 1;
	
	$(document).ready(function(){
		setupMethod("Hole");
		setupMethod("StraitCut");
		setupMethod("Pocket");
		sketchup.ready();
	});
	
	function setupMethod(methodStr) {

		$('#multipass_' + methodStr).checkboxradio();
		$('#multipass_' + methodStr).click(function() {
			if ($(this).is(':checked')) {
				$('#multipassdiv_' + methodStr).css('display', 'inline');
				methodTable3[methodStr].multipass = true;
			} else {
				$('#multipassdiv_' + methodStr).css('display', 'none');
				methodTable3[methodStr].multipass = false;
			}
			sketchup.newValue(methodTable3[methodStr].multipass,"multipass",methodStr);
			$( '#multipass_' + methodStr).removeClass("yellow");
		});
		 $('#depthstep_' + methodStr).spinner({
			step: 0.01,
			stop: function( event, ui ) {
				methodTable3[methodStr].depthstep = $( '#depthstep_' + methodStr ).spinner( "value" );
				sketchup.newValue(methodTable3[methodStr].depthstep,"depthstep",methodStr);
				$( '#depthstep_' + methodStr).removeClass("yellow");
				return true;
			}
		});

		 $('#overlapPercent_' + methodStr).spinner({
			step: 1.0,
			stop: function( event, ui ) {
				methodTable3[methodStr].overlapPercent = $( '#overlapPercent_' + methodStr ).spinner( "value" );
				sketchup.newValue(methodTable3[methodStr].overlapPercent,"overlapPercent",methodStr);
				$( '#overlapPercent_' + methodStr).removeClass("yellow");
				return true;
			}
		});


		$( '#depth_' + methodStr ).spinner({
			step: 0.01,
			stop: function( event, ui ) {
				methodTable3[methodStr].depth = $( '#depth_' + methodStr ).spinner( "value" );
				$( '#depthSlider_' + methodStr ).slider( "option", "values", depthData_Hole );
				sketchup.newValue(methodTable3[methodStr].depth,"depth",methodStr);
				$( '#depth_' + methodStr).removeClass("yellow");
				return true;
			}
		});
		$( '#depthSlider_' + methodStr ).slider({
			range: false,
			step: 0.01,
			min: 0,
			max: 6,
			values: [ 3 ],
			stop: function( event, ui ) {
				depthData_Hole = $( '#depthSlider_' + methodStr ).slider("values");
				methodTable3[methodStr].depth = depthData_Hole[0];
				$( '#depth_' + methodStr ).spinner( "value", methodTable3[methodStr].depth );
				sketchup.newValue(methodTable3[methodStr].depth,"depth",methodStr);
				return true;
			}
		});


		$( '#feedrate_' + methodStr ).spinner({
			step: 0.01,
			stop: function( event, ui ) {
				methodTable3[methodStr].feedrate = $( '#feedrate_' + methodStr ).spinner( "value" );
				sketchup.newValue(methodTable3[methodStr].feedrate,"feedrate",methodStr);
				$( '#feedrate_' + methodStr).removeClass("yellow");
				return true;
			}
		});

		$( '#methodType_' + methodStr ).selectmenu({
			change: function( event, data ) {
				methodTable3[methodStr].methodType = data.item.value
				sketchup.newValue(methodTable3[methodStr].methodType,"methodType",methodStr);
				$( '#methodType_' + methodStr + "-button").removeClass("yellow");
				if (methodStr == "Hole") {
					if (methodTable3[methodStr].methodType == "Pocket") {
						$('#methoddiv_Hole').css('display', 'none');
					} else {
						$('#methoddiv_Hole').css('display', 'inline');
					}
				}
				if (methodStr == "Pocket") {
					if (methodTable3[methodStr].methodType == "Pocket") {
						$('#methoddiv_Pocket').css('display', 'none');
					} else {
						$('#methoddiv_Pocket').css('display', 'inline');
					}
				}
				return true;
		   }
		 });

		$( '#drillBitName_' + methodStr ).selectmenu({
			change: function( event, data ) {
				methodTable3[methodStr].drillBitName = data.item.value;
				sketchup.newValue(methodTable3[methodStr].drillBitName,"drillBitName", methodStr);
				$( '#drillBitName_' + methodStr + "-button").removeClass("yellow");
				return true;
			}
		});
	};





	$( "#tabs" ).tabs();
	$("#tabs").tabs("option", "active", tabIndex);

	$("#tabs").click(function(){
		tabIndex = $("#tabs").tabs( "option", "active" );
		sketchup.tabValue(tabIndex);
	});


	$( "#cutwidth_Hole" ).spinner({step: 0.001});

	$( "#cutwidth_Pocket" ).spinner({step: 0.001});

	$( "#cutwidth_StraitCut" ).spinner({step: 0.01});
	$( "#cutwidth_StraitCut" ).on( "spinstop", function( event, ui ) {
		methodTable3["StraitCut"].cutwidth = $( "#cutwidth_StraitCut" ).spinner( "value" );
		sketchup.newValue(methodTable3["StraitCut"].cutwidth,"cutwidth","StraitCut");
		$( "#cutwidth_StraitCut").removeClass("yellow");
	});

	$( "#holesize_Hole" ).spinner({step: 0.001});
	$( "#holesize_Hole" ).on( "spinstop", function( event, ui ) {
		methodTable3["Hole"].holesize = $( "#holesize_Hole" ).spinner( "value" );
		sketchup.newValue(methodTable3["Hole"].holesize,"holesize","Hole");
		$( "#holesize_Hole").removeClass("yellow");
	});	

	$( "#nbdesegment_Hole" ).spinner({step: 1.0});
	$( "#nbdesegment_Hole" ).on( "spinstop", function( event, ui ) {
		methodTable3["Hole"].nbdesegment = $( "#nbdesegment_Hole" ).spinner( "value" );
		sketchup.newValue(methodTable3["Hole"].nbdesegment,"nbdesegment","Hole");
		$( "#nbdesegment_Hole").removeClass("yellow");
	});	


	$( "#apply, #cancel, #accept").button();
	$( "#apply" ).on( "click", function( event ) {
		sketchup.apply(spinData);
	} );
	$( "#accept" ).on( "click", function( event ) {
		sketchup.accept(spinData);
	} );
	$( "#cancel" ).on( "click", function( event ) {
		sketchup.cancel();
	} );
			
	function  addRowToTable(datajson) {
		drillBits.push(JSON.parse(datajson));
	};


	
	function  updateDialogTab(methodStr) {
		for (const mMethod in methodTable3[methodStr]) {
			if (methodTable3[methodStr][mMethod].type == "spinner") {
				$( '#' + mMethod + '_' + methodStr ).spinner( "value", methodTable3[methodStr][mMethod].Value );
				if (methodTable3[methodStr][mMethod].multiple) {
					$( '#' + mMethod + '_' + methodStr).addClass("yellow");
				}
			}
		}
		$( '#methodType_' + methodStr ).val(methodTable3[methodStr].methodType.Value);
		$( '#methodType_' + methodStr ).selectmenu("refresh");
		if (methodTable3[methodStr].methodType.multiple) {
			$( '#methodType_' + methodStr + "-button").addClass("yellow");
		}
		if (methodStr == "Hole") {
			if (methodTable3[methodStr].methodType == "Pocket") {
				$('#methoddiv_Hole').css('display', 'none');
			} else {
				$('#methoddiv_Hole').css('display', 'inline');
			}
		}
		if (methodStr == "Pocket") {
			if (methodTable3[methodStr].methodType == "Pocket") {
				$('#methoddiv_Pocket').css('display', 'none');
			} else {
				$('#methoddiv_Pocket').css('display', 'inline');
			}
		}

        if (methodTable3[methodStr].multipass.Value) { 
			$('#multipass_' + methodStr).prop( "checked", true );
			$('#multipass_' + methodStr).checkboxradio( "refresh" );
			$('#multipassdiv_' + methodStr).css('display', 'inline');
		} else {
			$('#multipass_' + methodStr).prop( "checked", false );
			$('#multipass_' + methodStr).checkboxradio( "refresh" );
			$('#multipassdiv_' + methodStr).css('display', 'none');
		}
		
		$( '#drillBitName_' + methodStr ).val(methodTable3[methodStr].drillBitName.Value);
		$( '#drillBitName_' + methodStr ).selectmenu("refresh");
		if (methodTable3[methodStr].drillBitName.multiple) {
			$( '#drillBitName_' + methodStr + "-button").addClass("yellow");
		}
	};

	function  updateMethod3(datajson) {
		methodTable3 =  JSON.parse(datajson);
		updateDialogTab("Hole");
		updateDialogTab("StraitCut");
		updateDialogTab("Pocket");
		$( "#numOfEdge" ).val(methodTable3.Pocket.numOfEdge.Value);
		$( "#nbdesegment_Hole" ).val(methodTable3.Hole.nbdesegment.Value)
	};

	function  updateMethod4(datajson) {
		methodTable3 =  JSON.parse(datajson);

		$( "#numOfEdge" ).val(methodTable3.Pocket.numOfEdge.Value);
		$( "#nbdesegment_Hole" ).val(methodTable3.Hole.nbdesegment.Value)
	};

	function  updateTab(datajson) {
		var datajson =  JSON.parse(datajson);
		tabIndex = datajson.tabIndex;
		 $("#tabs").tabs("option", "active", tabIndex);
	};

    // Define a modified populateDrillBitSelect function that accepts two or three parameters
    function populateDrillBitSelect(drillBitData, methodStr, tabId) {
      // The drillBitData parameter represents your data source for the select options.
      // The methodStr parameter is used to identify the specific method (Hole, StraitCut, or Pocket).
      // The tabId parameter (optional) specifies the tab ID where the select menu should be populated.

      // Here, you can implement the logic to populate the select menu based on the provided parameters.
      // You can use methodStr and tabId to target the appropriate select menu.

      // Example logic (replace with your actual data and logic):
      const selectId = 'drillBitName_' + methodStr;
      const selectElement = document.getElementById(selectId);
      
      // Clear existing options
      selectElement.innerHTML = "";

      // Populate the select menu based on drillBitData
      for (const drillBit of drillBitData) {
		value = drillBit.Name
		name = drillBit.Name.charAt(0).toUpperCase() + drillBit.Name.slice(1)
        const option = document.createElement("option");
        option.value = value;
        option.text = name + "  ("+drillBit.Cut_Diameter+drillBit.units+")";
        selectElement.appendChild(option);
      }
    }
	
	function  updateTable() {
		populateDrillBitSelect(drillBits, "Hole");
		populateDrillBitSelect(drillBits, "StraitCut");
		populateDrillBitSelect(drillBits, "Pocket");
	};

	</script>

</body>
</html>
